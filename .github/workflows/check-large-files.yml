name: Verificar arquivos grandes

on:
  push:        # roda a cada push
    branches: [ "main" ]
  workflow_dispatch:  # permite rodar manualmente tamb√©m

jobs:
  check-large-files:
    runs-on: ubuntu-latest
    steps:
      - name: Fazer checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Procurar arquivos maiores que 100 KB
        id: check
        shell: bash
        run: |
          echo "üîç Procurando arquivos maiores que 100 KB..."
          # lista arquivos com tamanho >=100k, ignora .git e node_modules
          RESULT=$(find . -type f ! -path "./.git/*" ! -path "./node_modules/*" -size +100k -exec ls -lh {} \; | awk '{print $9 " (" $5 ")"}')

          if [ -n "$RESULT" ]; then
            echo "üö® Foram encontrados arquivos grandes:"
            echo "$RESULT"
            echo "found=true" >> $GITHUB_OUTPUT
            echo "list=$RESULT" >> $GITHUB_OUTPUT
          else
            echo "‚úÖ Nenhum arquivo maior que 100 KB encontrado."
            echo "found=false" >> $GITHUB_OUTPUT
          fi

      - name: Alerta se arquivos grandes existirem
        if: ${{ steps.check.outputs.found == 'true' }}
        run: |
          echo "‚ö†Ô∏è ALERTA: Foram encontrados arquivos maiores que 100 KB!"
          echo "${{ steps.check.outputs.list }}"

      - name: Confirmar se tudo est√° ok
        if: ${{ steps.check.outputs.found == 'false' }}
        run: |
          echo "üü¢ Tudo certo ‚Äî nenhum arquivo grande foi encontrado."
